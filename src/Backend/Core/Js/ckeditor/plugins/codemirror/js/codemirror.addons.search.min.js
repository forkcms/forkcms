(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],b):b(CodeMirror)})(function(b){function q(b,e,a){var d;return d=b.getWrapperElement().appendChild(document.createElement("div")),d.className=a?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof e?d.innerHTML=e:d.appendChild(e),d}function v(b,e){b.state.currentNotificationClose&&b.state.currentNotificationClose();
b.state.currentNotificationClose=e}b.defineExtension("openDialog",function(f,e,a){function d(b){if("string"==typeof b)c.value=b;else if(!l&&(l=!0,k.parentNode.removeChild(k),n.focus(),a.onClose))a.onClose(k)}var c;a||(a={});v(this,null);var k=q(this,f,a.bottom),l=!1,n=this;if(c=k.getElementsByTagName("input")[0],c){if(c.focus(),a.value&&(c.value=a.value,!1!==a.selectValueOnOpen&&c.select()),a.onInput)b.on(c,"input",function(b){a.onInput(b,c.value,d)});if(a.onKeyUp)b.on(c,"keyup",function(b){a.onKeyUp(b,
c.value,d)});b.on(c,"keydown",function(f){a&&a.onKeyDown&&a.onKeyDown(f,c.value,d)||((27==f.keyCode||!1!==a.closeOnEnter&&13==f.keyCode)&&(c.blur(),b.e_stop(f),d()),13==f.keyCode&&e(c.value,f))});if(!1!==a.closeOnBlur)b.on(c,"blur",d)}else if(f=k.getElementsByTagName("button")[0]){b.on(f,"click",function(){d();n.focus()});if(!1!==a.closeOnBlur)b.on(f,"blur",d);f.focus()}return d});b.defineExtension("openConfirm",function(f,e,a){function d(){l||(l=!0,k.parentNode.removeChild(k),n.focus())}var c;v(this,
null);var k=q(this,f,a&&a.bottom);a=k.getElementsByTagName("button");var l=!1,n=this,r=1;a[0].focus();for(f=0;f<a.length;++f)c=a[f],function(a){b.on(c,"click",function(e){b.e_preventDefault(e);d();a&&a(n)})}(e[f]),b.on(c,"blur",function(){--r;setTimeout(function(){0>=r&&d()},200)}),b.on(c,"focus",function(){++r})});b.defineExtension("openNotification",function(f,e){function a(){c||(c=!0,clearTimeout(k),d.parentNode.removeChild(d))}v(this,a);var d=q(this,f,e&&e.bottom),c=!1,k,l=e&&"undefined"!=typeof e.duration?
e.duration:5E3;b.on(d,"click",function(e){b.e_preventDefault(e);a()});return l&&(k=setTimeout(a,l)),a})});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],b):b(CodeMirror)})(function(b){function q(g,a){return"string"==typeof g?g=new RegExp(g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),a?"gi":"g"):g.global||(g=new RegExp(g.source,g.ignoreCase?"gi":"g")),{token:function(a){g.lastIndex=
a.pos;var b=g.exec(a.string);if(b&&b.index==a.pos)return a.pos+=b[0].length||1,"searching";b?a.pos=b.index:a.skipToEnd()}}}function v(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function f(g){return g.state.search||(g.state.search=new v)}function e(g){return"string"==typeof g&&g==g.toLowerCase()}function a(g,a,b){return g.getSearchCursor(a,b,e(a))}function d(g,a,b,e,d){g.openDialog(a,e,{value:b,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){w(g)},onKeyDown:d})}function c(g,
a,b,e,d){g.openDialog?g.openDialog(a,d,{value:e,selectValueOnOpen:!0}):d(prompt(b,e))}function k(g,a,b,e){g.openConfirm?g.openConfirm(a,e):confirm(b)&&e[0]()}function l(g){return g.replace(/\\(.)/g,function(g,a){return"n"==a?"\n":"r"==a?"\r":a})}function n(g){var a=g.match(/^\/(.*)\/([a-z]*)$/);if(a)try{g=new RegExp(a[1],-1==a[2].indexOf("i")?"":"i")}catch(b){}else g=l(g);return("string"==typeof g?""==g:g.test(""))&&(g=/x^/),g}function r(g,a,b){a.queryText=b;a.query=n(b);g.removeOverlay(a.overlay,
e(a.query));a.overlay=q(a.query,e(a.query));g.addOverlay(a.overlay);g.showMatchesOnScrollbar&&(a.annotate&&(a.annotate.clear(),a.annotate=null),a.annotate=g.showMatchesOnScrollbar(a.query,e(a.query)))}function x(a,e,h,w){var m=f(a),l,p,k;if(m.query)return y(a,e);l=a.getSelection()||m.lastQuery;h&&a.openDialog?(p=null,k=function(e,d){(b.e_stop(d),e)&&(e!=m.queryText&&(r(a,m,e),m.posFrom=m.posTo=a.getCursor()),p&&(p.style.opacity=1),y(a,d.shiftKey,function(b,e){var d;3>e.line&&document.querySelector&&
(d=a.display.wrapper.querySelector(".CodeMirror-dialog"))&&d.getBoundingClientRect().bottom-4>a.cursorCoords(e,"window").top&&((p=d).style.opacity=.4)}))},d(a,z,l,k,function(e,d){var c=b.keyName(e),m=b.keyMap[a.getOption("keyMap")][c];m||(m=a.getOption("extraKeys")[c]);"findNext"==m||"findPrev"==m||"findPersistentNext"==m||"findPersistentPrev"==m?(b.e_stop(e),r(a,f(a),d),a.execCommand(m)):("find"==m||"findPersistent"==m)&&(b.e_stop(e),k(d,e))}),w&&l&&(r(a,m,l),y(a,e))):c(a,z,"Search for:",l,function(b){b&&
!m.query&&a.operation(function(){r(a,m,b);m.posFrom=m.posTo=a.getCursor();y(a,e)})})}function y(g,e,d){g.operation(function(){var c=f(g),m=a(g,c.query,e?c.posFrom:c.posTo);(m.find(e)||(m=a(g,c.query,e?b.Pos(g.lastLine()):b.Pos(g.firstLine(),0)),m.find(e)))&&(g.setSelection(m.from(),m.to()),g.scrollIntoView({from:m.from(),to:m.to()},20),c.posFrom=m.from(),c.posTo=m.to(),d&&d(m.from(),m.to()))})}function w(a){a.operation(function(){var b=f(a);(b.lastQuery=b.query,b.query)&&(b.query=b.queryText=null,
a.removeOverlay(b.overlay),b.annotate&&(b.annotate.clear(),b.annotate=null))})}function p(b,e,d){b.operation(function(){for(var c,m=a(b,e);m.findNext();)"string"!=typeof e?(c=b.getRange(m.from(),m.to()).match(e),m.replace(d.replace(/\$(\d)/g,function(a,b){return c[b]}))):m.replace(d)})}function h(b,e){if(!b.getOption("readOnly")){var d=b.getSelection()||f(b).lastQuery,h=e?"Replace all:":"Replace:";c(b,h+t,h,d,function(d){d&&(d=n(d),c(b,u,"Replace with:","",function(c){if(c=l(c),e)p(b,d,c);else{w(b);
var f=a(b,d,b.getCursor("from")),h=function(){var e=f.from(),l;!(l=f.findNext())&&(f=a(b,d),!(l=f.findNext())||e&&f.from().line==e.line&&f.from().ch==e.ch)||(b.setSelection(f.from(),f.to()),b.scrollIntoView({from:f.from(),to:f.to()}),k(b,A,"Replace?",[function(){y(l)},h,function(){p(b,d,c)}]))},y=function(a){f.replace("string"==typeof d?c:c.replace(/\$(\d)/g,function(b,e){return a[e]}));h()};h()}}))})}}var z='Search: \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',
t=' \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',u='With: \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e',A="Replace? \x3cbutton\x3eYes\x3c/button\x3e \x3cbutton\x3eNo\x3c/button\x3e \x3cbutton\x3eAll\x3c/button\x3e \x3cbutton\x3eStop\x3c/button\x3e";b.commands.find=function(a){w(a);x(a)};b.commands.findPersistent=
function(a){w(a);x(a,!1,!0)};b.commands.findPersistentNext=function(a){x(a,!1,!0,!0)};b.commands.findPersistentPrev=function(a){x(a,!0,!0,!0)};b.commands.findNext=x;b.commands.findPrev=function(a){x(a,!0)};b.commands.clearSearch=w;b.commands.replace=h;b.commands.replaceAll=function(a){h(a,!0)}});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],b):b(CodeMirror)})(function(b){function q(b,a,d,c){var k,l,n,r;this.atOccurrence=!1;this.doc=b;null==c&&"string"==typeof a&&(c=!1);d=d?b.clipPos(d):f(0,0);this.pos={from:d,to:d};"string"!=typeof a?(a.global||(a=new RegExp(a.source,a.ignoreCase?"ig":"g")),this.matches=function(d,c){var l,p,h,k,n;if(d){a.lastIndex=0;l=b.getLine(c.line).slice(0,
c.ch);for(p=0;(a.lastIndex=p,n=a.exec(l),n)&&(h=n,k=h.index,p=h.index+(h[0].length||1),p!=l.length););(p=h&&h[0].length||0)||(0==k&&0==l.length?h=void 0:k!=b.getLine(c.line).length&&p++)}else a.lastIndex=c.ch,l=b.getLine(c.line),p=(h=a.exec(l))&&h[0].length||0,k=h&&h.index,k+p==l.length||p||(p=1);if(h&&p)return{from:f(c.line,k),to:f(c.line,k+p),match:h}}):(k=a,c&&(a=a.toLowerCase()),l=c?function(a){return a.toLowerCase()}:function(a){return a},n=a.split("\n"),1==n.length?this.matches=a.length?function(d,
c){if(d){var n=b.getLine(c.line).slice(0,c.ch),p=l(n),h=p.lastIndexOf(a);if(-1<h)return h=v(n,p,h),{from:f(c.line,h),to:f(c.line,h+k.length)}}else if(n=b.getLine(c.line).slice(c.ch),p=l(n),h=p.indexOf(a),-1<h)return h=v(n,p,h)+c.ch,{from:f(c.line,h),to:f(c.line,h+k.length)}}:function(){}:(r=k.split("\n"),this.matches=function(a,c){var d=n.length-1,k,h,q,t,u;if(a){if(c.line-(n.length-1)<b.firstLine()||l(b.getLine(c.line).slice(0,r[d].length))!=n[n.length-1])return;k=f(c.line,r[d].length);t=c.line-
1;for(u=d-1;1<=u;--u,--t)if(n[u]!=l(b.getLine(t)))return;return(h=b.getLine(t),q=h.length-r[0].length,l(h.slice(q))!=n[0])?void 0:{from:f(t,q),to:k}}if(!(c.line+(n.length-1)>b.lastLine())&&(h=b.getLine(c.line),q=h.length-r[0].length,l(h.slice(q))==n[0])){k=f(c.line,q);t=c.line+1;for(u=1;u<d;++u,++t)if(n[u]!=l(b.getLine(t)))return;if(l(b.getLine(t).slice(0,r[d].length))==n[d])return{from:k,to:f(t,r[d].length)}}}))}function v(b,a,d){var c;if(b.length==a.length)return d;for(a=Math.min(d,b.length);;)if(c=
b.slice(0,a).toLowerCase().length,c<d)++a;else if(c>d)--a;else return a}var f=b.Pos;q.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(b){function a(a){a=f(a,0);return d.pos={from:a,to:a},d.atOccurrence=!1,!1}for(var d=this,c=this.doc.clipPos(b?this.pos.from:this.pos.to),k;;){if(this.pos=this.matches(b,c))return this.atOccurrence=!0,this.pos.match||!0;if(b){if(!c.line)return a(0);c=f(c.line-1,this.doc.getLine(c.line-1).length)}else{if(k=
this.doc.lineCount(),c.line==k-1)return a(k);c=f(c.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e,a){if(this.atOccurrence){var d=b.splitLines(e);this.doc.replaceRange(d,this.pos.from,this.pos.to,a);this.pos.to=f(this.pos.from.line+d.length-1,d[d.length-1].length+(1==d.length?this.pos.from.ch:0))}}};b.defineExtension("getSearchCursor",function(b,a,d){return new q(this.doc,b,a,d)});b.defineDocExtension("getSearchCursor",
function(b,a,d){return new q(this,b,a,d)});b.defineExtension("selectMatches",function(e,a){for(var d=[],c=this.getSearchCursor(e,this.getCursor("from"),a);c.findNext()&&!(0<b.cmpPos(c.to(),this.getCursor("to")));)d.push({anchor:c.from(),head:c.to()});d.length&&this.setSelections(d,0)})});