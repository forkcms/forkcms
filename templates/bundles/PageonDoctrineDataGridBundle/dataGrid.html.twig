{% import '@Backend/base/macros.html.twig' as macro %}

{% set dataGridEmptyAction = dataGridEmptyAction|default(null) %}
{% set dataGridEmptyModule = dataGridEmptyModule|default(null) %}
{% set dataGridEmptyParameters = dataGridEmptyParameters|default([]) %}
{% set dataGridEmptyRelative = dataGridEmptyRelative|default(false) %}
{% set dataGridEmptyLocale = dataGridEmptyLocale|default(null) %}
{% set dataGridEmptyLabel = dataGridEmptyLabel|default('lbl.Add'|trans|ucfirst) %}
{% set dataGridWrapperClass = dataGridWrapperClass|default('table-responsive fork-data-grid') %}

{% if dataGrid.paginator is not empty or dataGrid.paginator.params.filterValue is defined %}
  <div class="{{ dataGridWrapperClass }}">
    {% embed '@!PageonDoctrineDataGrid/dataGrid.html.twig' %}
      {% block noResults %}{% endblock %}
      {% block columnValue %}
        {% set value = column.showColumnLabel or column.hasValueCallback ? column.value(attribute(row, column.name), row, column.name) : column.label|trans|ucfirst %}
        {% set valueType = value|type %}
        {% set isHtml = column.isHtml %}
        {% if valueType == 'DateTime' or valueType == 'DateTimeImmutable' %}
          {% set value = value|user_format_longdatetime %}
        {% endif %}
        {% if valueType == 'ForkCMS\\Modules\\Backend\\Domain\\User\\User' %}
          {% set value %}
            <div class="fork-data-grid-avatar">
              {% if is_allowed('UserEdit', 'Backend') %}<a href="{{ action_url('UserEdit', 'Backend', {slug: value.id}) }}">{% endif %}
                <img src="{{ '@BackendModuleBackend:images/no-avatar.gif'|imagine_filter('backend_avatar') }}" class="rounded-circle" alt="{{ value.displayname }}" width="24" height="24"/>
                <span>{{ value.displayname }}</span>
              {% if is_allowed('UserEdit', 'Backend') %}</a>{% endif %}
            </div>
          {% endset %}
          {% set isHtml = true %}
        {% endif %}
        {% if column.route is null %}
          {% if isHtml %}{{ value|raw }}{% else %}{{ value }}{% endif %}
        {% else %}
          <a href="{{ path(column.route, column.routeAttributes(row)) }}"{% if column.class %} class="{{ column.class }}"{% endif %}>{% if column.iconClass %}<i class="{{ column.iconClass }}"></i> {% endif %}
            {% if isHtml %}{{ value|raw }}{% else %}{{ value }}{% endif %}
          </a>
        {% endif %}
      {% endblock %}
    {% endembed %}
  </div>
{% endif %}
{% if dataGrid.paginator is empty %}
  <div class="empty-state">
    <img class="empty-state-illustration mb-4 vis" src="{{ asset('assets/modules/Backend/Backend/images/empty-state.svg') }}" aria-hidden="true" alt="empty data grid icon">
    <p class="text-black mb-2">
      <strong> {{ (dataGrid.noResultsMessage == 'No results' ? 'lbl.NoResultsFound' : dataGrid.noResultsMessage)|trans|ucfirst }}</strong>
    </p>
    {% if dataGridEmptyAction is not null %}
      <a class="empty-state-add" href="{{ action_url(dataGridEmptyAction, dataGridEmptyModule, dataGridEmptyParameters, dataGridEmptyRelative, dataGridEmptyLocale) }}">
        {{ dataGridEmptyLabel }}
      </a>
    {% endif %}
  </div>
{% endif %}
